# Application
APP_NAME=corporate-data-harmonization
APP_VERSION=1.0.0
APP_ENV=production

# Docker / Network
ML_NETWORK_NAME=ml-network
ML_NETWORK_DRIVER=bridge

# PostgreSQL
POSTGRES_CONTAINER_NAME=postgres
POSTGRES_IMAGE=postgres:15-alpine
POSTGRES_PORT=5432

# Spark Core
SPARK_APP_NAME=CorpIQ
SPARK_MASTER=spark://spark-master:7077

SPARK_JARS_PACKAGES=org.apache.iceberg:iceberg-spark-runtime-3.5_2.12:1.7.1,org.apache.iceberg:iceberg-aws-bundle:1.7.1,org.apache.hadoop:hadoop-aws:3.3.4,com.amazonaws:aws-java-sdk-bundle:1.12.523,graphframes:graphframes:0.8.3-spark3.5-s_2.12

SPARK_SHUFFLE_PARTITIONS=200
SPARK_EXECUTOR_MEMORY=4g
SPARK_DRIVER_MEMORY=2g

SPARK_IMAGE=apache/spark:3.5.0
SPARK_MASTER_PORT=7077
SPARK_UI_PORT=8080
SPARK_MASTER_URL=spark://spark-master:7077

# Airflow
AIRFLOW_DB_CONN=postgresql+psycopg2://admin:admin@postgres:5432/app
AIRFLOW_WEB_PORT=8823

# AWS / S3 / Iceberg
AWS_ACCESS_KEY_ID=REPLACE_ME
AWS_SECRET_ACCESS_KEY=REPLACE_ME
AWS_REGION=ap-south-1

S3_ENDPOINT=s3.ap-south-1.amazonaws.com
S3_PATH_STYLE=false

ICEBERG_CATALOG_NAME=iceberg
ICEBERG_REST_URI=http://localhost:8181
ICEBERG_WAREHOUSE=s3://corporate-data-warehouse/iceberg
ICEBERG_DATABASE=corporate_db
ICEBERG_TABLE=corporate_registry
ICEBERG_REST_PORT=8181

ICEBERG_PARTITION_FIELD=created_at
ICEBERG_PARTITION_TRANSFORM=day
ICEBERG_SORT_FIELD=corporate_id
ICEBERG_SORT_DIRECTION=asc


# Model Serving
MODEL_MLFLOW_TRACKING_URI=http://mlflow-server:5112
MODEL_NAME=corporate-profit-predictor
MODEL_STAGE=Staging
MODEL_SERVER_PORT=8000


# Data Sources
SOURCE1_PATH=s3://corporate-data-warehouse/raw/supply_chain_mock_data_extended.csv
SOURCE1_FORMAT=csv
SOURCE1_SCHEMA_VALIDATION=true

SOURCE2_PATH=s3://corporate-data-warehouse/raw/financial_mock_data_extended.csv
SOURCE2_FORMAT=csv
SOURCE2_SCHEMA_VALIDATION=true


# Entity Resolution
ENTITY_MATCH_THRESHOLD=0.6
DEDUP_STRATEGY=weighted_score

FUZZY_NAME_WEIGHT=0.6
FUZZY_NAME_METHOD=jaro_winkler

FUZZY_ADDRESS_WEIGHT=0.3
FUZZY_ADDRESS_METHOD=token_sort

FUZZY_POSTAL_WEIGHT=0.1
FUZZY_POSTAL_METHOD=exact


# LLM / Adverse Media
LLM_PROVIDER=openai
LLM_MODEL=gpt-4o
OPENAI_API_KEY=REPLACE_ME

LLM_MAX_TOKENS=1000
LLM_TEMPERATURE=0.3

LLM_MAX_CALLS_PER_MINUTE=50
LLM_MAX_RETRIES=3
LLM_BACKOFF_FACTOR=2

ADVERSE_MEDIA_ENABLED=true
ADVERSE_MEDIA_DAYS_BACK=365
ADVERSE_MEDIA_BATCH_SIZE=10


# Data Quality
DATA_QUALITY_ERROR_THRESHOLD=0.05


# Logging
LOG_LEVEL=INFO
LOG_ROTATION='500 MB'
LOG_RETENTION='30 days'
LOG_TO_FILE=true
LOG_FILE_PATH=logs/pipeline.log


# Monitoring
METRICS_ENABLED=true
PROMETHEUS_PORT=8000

CHECKPOINTS_ENABLED=true
CHECKPOINT_LOCATION=s3://corporate-data-warehouse/checkpoints/


# Performance
CACHE_INTERMEDIATE_RESULTS=true
BROADCAST_JOIN_THRESHOLD=10MB
MAX_RECORDS_PER_FILE=500000


# Retry
RETRY_MAX_ATTEMPTS=3
RETRY_EXPONENTIAL_BACKOFF=true
RETRY_INITIAL_WAIT=5
RETRY_MAX_WAIT=60


# ML Pipeline
ML_PIPELINE_NAME=corporate-profit-prediction
ML_PIPELINE_VERSION=1.0.0
ML_PIPELINE_DESCRIPTION='Predict if corporation profit exceeds threshold'


# Data / Training
SOURCE_TABLE=iceberg.corporate_db.corporate_registry
TARGET_COLUMN=profit_above_threshold
PROFIT_THRESHOLD=10000000

TEST_SIZE=0.2
VALIDATION_SIZE=0.1
DATA_RANDOM_SEED=42
STRATIFY_SPLIT=true

MIN_RECORDS=100
MAX_NULL_PERCENTAGE=0.3
MIN_POSITIVE_CLASS_RATIO=0.1
MAX_POSITIVE_CLASS_RATIO=0.9


# Feature Engineering
SCALING_METHOD=standard
CATEGORICAL_ENCODING_METHOD=one_hot
MAX_CATEGORIES=50
HANDLE_UNKNOWN_CATEGORIES=infrequent

FEATURE_SELECTION_ENABLED=true
FEATURE_SELECTION_METHOD=correlation
FEATURE_SELECTION_THRESHOLD=0.05


# Model
MODEL_ALGORITHM=logistic_regression

LR_MAX_ITER=100
LR_REG_PARAM=0.01
LR_ELASTIC_NET=0.0
LR_THRESHOLD=0.5

RF_NUM_TREES=100
RF_MAX_DEPTH=10
RF_MIN_INSTANCES=1
RF_SUBSAMPLING_RATE=0.8

GBT_MAX_ITER=100
GBT_MAX_DEPTH=5
GBT_STEP_SIZE=0.1

CLASS_IMBALANCE_METHOD=auto
CLASS_IMBALANCE_TARGET_RATIO=0.5


# Hyperparameter Tuning
HYPERPARAM_TUNING_ENABLED=false
HYPERPARAM_TUNING_METHOD=grid_search

CV_NUM_FOLDS=5
CV_PARALLELISM=4

OPTIMIZATION_METRIC=areaUnderROC
OPTIMIZATION_MODE=maximize


# Evaluation
MIN_ACCURACY=0.7
MIN_PRECISION=0.65
MIN_RECALL=0.65
MIN_AUC_ROC=0.75

MODEL_VALIDATION_ENABLED=true
HOLDOUT_TEST_ENABLED=true
EVAL_CROSS_VALIDATION=false


# MLflow
MLFLOW_TRACKING_URI=http://localhost:5112
MLFLOW_EXPERIMENT_NAME=corporate-profit-prediction

MLFLOW_MODEL_NAME=corporate-profit-predictor
MLFLOW_STAGING_ENABLED=true

MLFLOW_AUTO_PROMOTE=false
MLFLOW_APPROVAL_REQUIRED=true
MLFLOW_MIN_ACCURACY=0.8

MLFLOW_LOG_MODEL=true
MLFLOW_LOG_FEATURE_IMPORTANCE=true
MLFLOW_LOG_CONFUSION_MATRIX=true
MLFLOW_LOG_ROC_CURVE=true
MLFLOW_LOG_PR_CURVE=true
MLFLOW_LOG_DATA_PROFILE=true

MLFLOW_PROJECT_TAG=corporate-data-harmonization
MLFLOW_MODEL_TYPE_TAG=classification
MLFLOW_FRAMEWORK_TAG=spark-ml


# Model Monitoring
MODEL_MONITORING_ENABLED=true

DATA_DRIFT_ENABLED=true
DATA_DRIFT_BASELINE_DAYS=30
DATA_DRIFT_DETECTION_DAYS=7
DATA_DRIFT_THRESHOLD=0.05

PERFORMANCE_MONITORING_ENABLED=true
ALERT_THRESHOLD_DROP=0.05

LOG_PREDICTIONS=true
PREDICTION_SAMPLE_RATE=0.1
PREDICTION_STORE_LOCATION=s3://corporate-data-warehouse/predictions/


# Reproducibility
GLOBAL_SEED=42
DETERMINISTIC_RUNS=true
TRACK_ENVIRONMENT=true

TRACK_CODE_VERSION=true
TRACK_DATA_VERSION=true
TRACK_CONFIG_VERSION=true


# Resources
RESOURCE_EXECUTOR_MEMORY=4g
RESOURCE_EXECUTOR_CORES=2
RESOURCE_NUM_EXECUTORS=4
RESOURCE_DRIVER_MEMORY=2g

MAX_TRAINING_TIME_MINUTES=60
TRAINING_CHECKPOINT_INTERVAL=10
